var Adjust={version:.01,dpr:window.devicePixelRatio,width:window.innerWidth*this.dpr,height:window.innerHeight*this.dpr,realWidth:window.innerWidth,realHeight:window.innerHeight,mouse:new THREE.Vector2,offset:new THREE.Vector3,objects:[],half:{width:.5*this.width/this.dpr,height:.5*this.height/this.dpr},raycaster:new THREE.Raycaster,selected:null,intersected:null,labels:[]};Adjust.init=function(){this.bindEvents(),this.resize(),this.plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(200,200,8,8),new THREE.MeshPhongMaterial({visible:!1})),scene.add(this.plane)},Adjust.bindEvents=function(){window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mouseup",this.onMouseUp,!1)},Adjust.randNum=function(t,e,s){var i=Math.floor(Math.random()*e)+t;return(s||"undefined"==typeof s)&&(i*=1==Math.floor(2*Math.random())?1:-1),i},Adjust.trackElements=function(t){if("object"==typeof this.elements){var e=document.getElementsByClassName(t),s=[];this.domElementsBool=!0;for(var i=0;i<this.elements.length;i++)s.push(this.elements[i]);for(var n=0;n<e.length;n++)s.push(e[n]);this.elements=s}else"undefined"!=typeof t?(this.elements=document.getElementsByClassName(t),this.domElementsBool=!0):console.warn("No argument! classname required")},Adjust.untrackElements=function(){this.domElementsBool=!1;for(var t=0;t<this.elements.length;t++)this.elements[t].style="";this.elements=[]},Adjust.addLabel=function(t){this.updateLabelsBool=!0;for(var e=document.getElementsByClassName(t),s=0;s<e.length;s++)this.labels.push(e[s]),scene.children.forEach(function(t,i){t.name==e[s].dataset.label&&(e[s]._dirtyCustom=t)})},Adjust.updateSingleLabel=function(t,e){var s=0,i=0;"undefined"!=typeof t.dataset.offsetx&&(s=t.dataset.offsetx),"undefined"!=typeof t.dataset.offsety&&(i=t.dataset.offsety);var n=new THREE.Vector3,h={x:parseFloat(t._dirtyCustom.position.x)-s,y:parseFloat(t._dirtyCustom.position.y)-i,z:parseFloat(t._dirtyCustom.position.z)};return n.set(h.x,h.y,h.z),this.convertVector(n,e),this.domElement(t,n),n},Adjust.resize=function(){this.dpr=window.devicePixelRatio,this.width=window.innerWidth*this.dpr,this.height=window.innerHeight*this.dpr,this.realWidth=window.innerWidth,this.realHeight=window.innerHeight,this.half.width=.5*this.width/this.dpr,this.half.height=.5*this.height/this.dpr},Adjust.domElement=function(t,e,s){var i=t.getBoundingClientRect().width/2,n=t.getBoundingClientRect().height/2;e.x-=i,e.y-=n,e.z=Math.max(3-e.z,.1),t.style.webkitTransform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)",t.style.MozTransform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)",t.style.OTransform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)",t.style.transform="translateX("+e.x+"px) translateY("+e.y+"px) translateZ("+e.z+"px)","undefined"!=typeof s&&(t.dataset.bound=s)},Adjust.convertVector=function(t,e){return t.project(e),t.x=t.x*this.half.width+this.half.width,t.y=-(t.y*this.half.height)+this.half.height,t.z=t.z*(this.half.width/this.half.height)/2+this.half.width/this.half.height*2,t},Adjust.element=function(t,e){var s=new THREE.Vector3;if("undefined"==typeof this.width&&this.init(),0==Object.keys(t.dataset).length)return console.warn("Missing data Attribute on Element:",t),!1;var i={x:parseFloat(t.dataset.x),y:parseFloat(t.dataset.y),z:parseFloat(t.dataset.z)};return s.set(i.x,i.y,i.z),this.convertVector(s,e),this.domElement(t,s),s},Adjust.setMouse=function(t){return this.mouse=t,this.mouse},Adjust.normalizeMouse=function(t){var e={x:t.x/this.width*2-1,y:t.y/this.height*2+1,z:.5};return e},Adjust.onMouseMove=function(t){Adjust.setMouse({x:t.clientX,y:t.clientY,z:.5})},Adjust.checkSelected=function(){null!=this.intersected?(this.selected=this.intersected,this.selectedState(this.intersected)):this.selected=null},Adjust.uncheckSelected=function(){this.intersected&&("undefined"!=typeof this.passivState&&this.passivState(this.intersected),this.intersected._draggable&&this.plane.position.copy(this.intersected.position)),this.intersected=null,this.selected=null},Adjust.onMouseDown=function(t){Adjust.checkSelected()},Adjust.onMouseUp=function(t){Adjust.uncheckSelected()},Adjust.checkPointInRadius=function(t,e,s,i){var n=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z),h=[s*s*s>=n,n];return i(h[0],h[1]),h},Adjust.update=function(t){if(this.domElementsBool)for(var e=0;e<this.elements.length;e++)this.element(this.elements[e],t);if(this.updateLabelsBool)for(var s=0;s<this.labels.length;s++)this.updateSingleLabel(this.labels[s],t);this.activeObjectUpdate&&this.checkMouseCollision(t)},Adjust.addActiveObject=function(t,e,s,i,n){this.activState=e,this.passivState=s,this.selectedState=i,this.activeObjectUpdate=!0,this.objects.push(t),this.addDraggable(t,n)},Adjust.addDraggable=function(t,e){t._draggable=e},Adjust.checkMouseCollision=function(t){var e=new THREE.Vector3;return e.set(this.mouse.x/this.realWidth*2-1,2*-(this.mouse.y/this.realHeight)+1,.5),this.raycaster.setFromCamera(e,t),null!=this.selected?(this.intersects=this.raycaster.intersectObject(this.plane),void(this.intersects.length>0&&(this.plane.position.copy(this.intersected.position),this.plane.lookAt(t.position),this.intersected._draggable&&this.selected.position.copy(this.intersects[0].point.sub(this.offset))))):(this.intersects=this.raycaster.intersectObjects(this.objects),void(this.intersects.length>0?(this.intersected!=this.intersects[0].object&&(this.intersected&&this.passivState(this.intersected),this.intersected=this.intersects[0].object,this.plane.position.copy(this.intersected.position),this.plane.lookAt(t.position)),this.intersected&&this.activState(this.intersected)):(this.intersected&&this.passivState(this.intersected),this.intersected=null,this.selected=null)))},Adjust.mouseToSpace=function(t){var e=new THREE.Vector3;e.set(this.mouse.x/this.realWidth*2-1,2*-(this.mouse.y/this.realHeight)+1,.5),e.unproject(t);var s=e.sub(t.position).normalize(),i=-t.position.y/s.y,n=t.position.clone().add(s.multiplyScalar(i));return n};